{% extends "family/base.html" %}
{% load static %}

{% block title %}Genealogy{% endblock %}

{% block style %}
<style>
  html, body {
    width: 100%;
    height: 100%;
  }
  body {
    display: flex;
    flex-direction: column;
  }
  .wrap {
    margin-top: 10px;
    position: relative;
    overflow: hidden;
    flex: 1;
  }
</style>
{% endblock %}

{% block content %}
<div class="wrap">
  <div id="myDiagramDiv" style="width:100%; height:100%; background-color: #DAE4E4;"></div>
</div>


{% for relation in relations %}
<div data-key="{{relation.individual_1_id.id}}" data-parent="{{relation.individual_2_id.id}}" data-name="{{relation.individual_1_id.last_name}}"  data-source="{{relation.individual_1_id.image_path}}"></div>
{% endfor %}


{% endblock %}

{% block script %}
<script src="{% static 'libs/js/go-debug.js' %}"></script>

<script>
  var $ = go.GraphObject.make;
  
  var myDiagram = $(go.Diagram,
    "myDiagramDiv",
    {
      initialAutoScale: go.Diagram.Uniform,
      "undoManager.isEnabled": true,
      layout: $(
        go.TreeLayout,
        {
          angle: 0,
          layerSpacing: 20
        }
      )
    }
  );

  myDiagram.nodeTemplate = $(go.Node,
    "Vertical",
    { background: "#44CCFF" },
    $(go.Picture,
      { margin: 6, width: 64, height: 64, background: "red" },
      new go.Binding("source")
    ),
    $(go.TextBlock,
      "Default Text",
      { margin: 6, width: 64, stroke: "white", font: "bold 16px sans-serif", wrap: go.TextBlock.None },
      new go.Binding("text", "name")
    ),
    // $("TreeExpanderButton")
  );

  myDiagram.linkTemplate = $(go.Link,
    { routing: go.Link.Orthogonal, corner: 5 },
    $(go.Shape,
      { strokeWidth: 3, stroke: "#555" }
    )
  );

  var model = $(go.TreeModel);


  
  window.onload = function() {
    arr = [

      
      {key: "努尔哈赤", parent: "", name: "努尔哈赤", source: "/media/individual_3/htj.jpeg"}
    ];
    fetch('genealogy/').then(response => response.json()).then((json)=>{
      console.log(json)
      for (var i=0; i<json.length; i++) {
        var obj = {};
        obj.key = json[i].fields.individual_1_id.last_name
        obj.parent = json[i].fields.individual_2_id.last_name
        obj.name = json[i].fields.individual_1_id.last_name
        obj.source = {{ MEDIA_URL }} + json[i].fields.individual_1_id.image_path
        arr.push(obj)
      }
      console.log(arr)
      model.nodeDataArray = arr
      myDiagram.model = model;
    })            
}

</script>
{% endblock %}
